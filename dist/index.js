import I from"cli-progress";import{green as y}from"colorette";import N from"fs";import U from"https";import _ from"http";import j from"got";var q=async({name:e,id:o,server:n})=>{let r="",t="";n==="kuwo"?r=`https://www.kuwo.cn/api/v1/www/music/playUrl?mid=${o}&type=1`:r=`https://music.163.com/api/song/enhance/player/url?id=${o}&ids=[${o}]&br=3200000`;let{body:p}=await j(r);n==="kuwo"?t=new Function("return "+p)().data.url:t=JSON.parse(p).data[0].url;let a=new I.SingleBar({format:"\u4E0B\u8F7D\u8FDB\u5EA6 | {bar} | {percentage}%",barCompleteChar:"\u2588",barIncompleteChar:"\u2591",hideCursor:!0});console.log(y("\u6587\u4EF6\u4E0B\u8F7D\u5F00\u59CB..."));let l=t.startsWith("https://")?U:_,s=t.split(".").pop();l.get(t,i=>{let c=N.createWriteStream(`${e}.${s}`);i.pipe(c),a.start(Number(i.headers["content-length"]),0);let g=0;i.on("data",u=>{g+=u.length,a.update(g)}),c.on("finish",()=>{a.stop(),console.log(y("\u6587\u4EF6\u4E0B\u8F7D\u5B8C\u6210")),c.end(),process.exit(0)})})},h=q;import E from"update-notifier";var f={name:"downloadsong",version:"1.0.7",description:"\u97F3\u4E50\u4E0B\u8F7D\u5DE5\u5177\uFF0C\u76EE\u524D\u652F\u6301\u9177\u6211\u3001\u7F51\u6613\u4E91",main:"index.js",bin:{downloadSong:"bin/downloadSong.js",dls:"bin/downloadSong.js"},scripts:{test:'echo "Error: no test specified" && exit 1',build:"tsup"},repository:{type:"git",url:"https://github.com/Quanzhitong"},type:"module",keywords:["\u7F51\u6613\u4E91","\u9177\u6211","\u97F3\u4E50"],author:"Qzt",license:"ISC",dependencies:{axios:"^0.27.2","cli-progress":"^3.11.1",colorette:"^2.0.17",commander:"^9.3.0",got:"^12.3.1",prompts:"^2.4.2",request:"^2.88.2","single-line-log":"^1.1.2","update-notifier":"^5.1.0"},devDependencies:{"@types/cli-progress":"^3.11.0","@types/got":"^9.6.12","@types/node":"^18.6.3","@types/prompts":"^2.0.14","@types/request":"^2.48.8","@types/update-notifier":"^6.0.1","@typescript-eslint/parser":"^5.32.0",eslint:"^8.21.0","ts-loader":"^9.3.1","ts-node":"^10.9.1",tsup:"^6.1.3",typescript:"^4.7.4",webpack:"^5.74.0","webpack-cli":"^4.10.0"}};import{Command as L}from"commander";import{cyan as m,yellow as b,cyanBright as O}from"colorette";var d=new L,R=(()=>(E({pkg:f}).notify(),d.name("downloadSong or dls").usage("<text>").version(f.version),d.option("-s, --server",'\u6307\u5B9A\u4E0B\u8F7D\u6E90\uFF0C\u53EF\u4EE5\u662F\u9177\u6211("kuwo")\u6216\u8005\u7F51\u6613\u4E91("wangyi"), \u9ED8\u8BA4\u9177\u6211'),d.on("--help",()=>{console.log(""),console.log(O("Examples:")),console.log(b("\u4E0B\u8F7D:")),console.log(m("  $ ")+"downloadSong \u8BB8\u5D69"),console.log(m("  # ")+"or"),console.log(m("  $ ")+"dls \u8BB8\u5D69"),console.log(""),console.log(b("\u6307\u5B9A\u4E0B\u8F7D\u6E90:")),console.log(m("  $ ")+"dls \u5468\u6770\u4F26 -s kuwo"),console.log(m("  $ ")+"downloadSong \u859B\u4E4B\u8C26 --server wangyi")}),d.parse(process.argv),d.args))(),S=R;import J from"prompts";var z=({name:e,artists:o,id:n,server:r},t)=>({title:`${t+1}. ${e} -[ ${o[0].name} ]`,value:{name:e,id:n,server:r}}),x=z;var P=async e=>await J([{type:"select",name:"song",message:"\u5171\u6709 "+e.length+" \u4E2A\u7ED3\u679C, \u6309\u4E0B\u7A7A\u683C\u6216\u56DE\u8F66\u4E0B\u8F7D",choices:e.map((o,n)=>x(o,n))}]),$=P;import w from"got";import{green as A,red as k}from"colorette";var B=async e=>{let o=e[0],n=e[1]||"kuwo";o===""&&(console.error(A("\u8BF7\u8F93\u5165\u6B4C\u66F2\u540D\u79F0\u6216\u6B4C\u624B\u540D\u5B57")),process.exit(1));let r="",t=[];if(n==="kuwo"){r=`http://search.kuwo.cn/r.s?all=${encodeURIComponent(o)}&ft=music&client=kt&vipver=1&rn=20&rformat=json&encoding=utf8`;let{body:p}=await w(r),a=new Function("return "+p)(),{abslist:l}=a;t=l.map(s=>({id:s.DC_TARGETID,name:s.NAME,artists:[{name:s.ARTIST}],server:n})),l.length===0&&(console.error(k(`\u6CA1\u641C\u7D22\u5230 ${o} \u7684\u76F8\u5173\u7ED3\u679C`)),process.exit(1))}else{r=`https://music.163.com/api/search/get/web?s=${encodeURIComponent(o)}&type=1&limit=20&offset=20`;let{body:p}=await w(r),{result:{songs:a=[],songCount:l}}=JSON.parse(p);t=a.filter(s=>s.fee!==1);for(let s of t){let i=`https://music.163.com/api/song/enhance/player/url?id=${s.id}&ids=[${s.id}]&br=3200000`,{body:c}=await w(i),{data:g}=JSON.parse(c),{url:u,size:C,type:T}=g[0];Object.assign(s,{url:u,size:C,extension:T})}a.length===0&&(console.error(k(`\u6CA1\u641C\u7D22\u5230 ${o} \u7684\u76F8\u5173\u7ED3\u679C`)),process.exit(1))}return t},v=B;var F=async()=>{let e=await v(S),{song:o}=await $(e);o&&await h(o)},wo=F;export{wo as default};
