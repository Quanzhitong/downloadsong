import C from"cli-progress";import{green as u}from"colorette";import v from"fs";import T from"https";import j from"http";import q from"got";var I=async({name:o,id:e})=>{let t=`https://music.163.com/api/song/enhance/player/url?id=${e}&ids=[${e}]&br=3200000`,{body:r}=await q(t),{url:a}=JSON.parse(r).data[0],n=new C.SingleBar({format:"\u4E0B\u8F7D\u8FDB\u5EA6 | {bar} | {percentage}%",barCompleteChar:"\u2588",barIncompleteChar:"\u2591",hideCursor:!0});console.log(u("\u6587\u4EF6\u4E0B\u8F7D\u5F00\u59CB..."));let s=a.startsWith("https://")?T:j,m=a.split(".").pop();s.get(a,p=>{let i=v.createWriteStream(`${o}.${m}`);p.pipe(i),n.start(Number(p.headers["content-length"]),0);let c=0;p.on("data",d=>{c+=d.length,n.update(c)}),i.on("finish",()=>{n.stop(),console.log(u("\u6587\u4EF6\u4E0B\u8F7D\u5B8C\u6210")),i.end(),process.exit(0)})})},y=I;import k from"update-notifier";var g={name:"downloadsong",version:"1.0.2",description:"\u9AD8\u8D28\u91CF\u7F51\u6613\u4E91\u97F3\u4E50\u4E0B\u8F7D",main:"index.js",bin:{downloadSong:"bin/downloadSong.js",dls:"bin/downloadSong.js"},scripts:{test:'echo "Error: no test specified" && exit 1',build:"tsup"},repository:{type:"git",url:"https://github.com/Quanzhitong"},type:"module",keywords:["wy","\u7F51\u6613\u4E91\u97F3\u4E50","\u7F51\u6613\u4E91","\u97F3\u4E50"],author:"Qzt",license:"ISC",dependencies:{axios:"^0.27.2","cli-progress":"^3.11.1",colorette:"^2.0.17",commander:"^9.3.0",got:"^12.3.1",prompts:"^2.4.2",request:"^2.88.2","single-line-log":"^1.1.2","update-notifier":"^5.1.0"},devDependencies:{"@types/cli-progress":"^3.11.0","@types/got":"^9.6.12","@types/node":"^18.6.3","@types/prompts":"^2.0.14","@types/request":"^2.48.8","@types/update-notifier":"^6.0.1","@typescript-eslint/parser":"^5.32.0",eslint:"^8.21.0","ts-loader":"^9.3.1","ts-node":"^10.9.1",tsup:"^6.1.3",typescript:"^4.7.4",webpack:"^5.74.0","webpack-cli":"^4.10.0"}};import{Command as O}from"commander";import{gray as U,cyan as f}from"colorette";var l=new O,z=(()=>(k({pkg:g}).notify(),l.name("downloadSong or dls").usage("<text>").version(g.version),l.on("--help",()=>{console.log(""),console.log(U("Examples:")),console.log(f("  $ ")+"downloadSong \u8BB8\u5D69"),console.log(f("  # ")+"or"),console.log(f("  $ ")+"dls \u8BB8\u5D69"),console.log("")}),l.parse(process.argv),l.args.join(" ")))(),h=z;import w from"got";import{green as D,red as J}from"colorette";var L=async o=>{o===""&&(console.error(D("\u8BF7\u8F93\u5165\u6B4C\u66F2\u540D\u79F0\u6216\u6B4C\u624B\u540D\u5B57")),process.exit(1));let e=`https://music.163.com/api/search/get/web?s=${encodeURIComponent(o)}&type=1&limit=20&offset=20`,{body:t}=await w(e),{result:{songs:r=[],songCount:a}}=JSON.parse(t),n=r.filter(s=>s.fee!==1);for(let s of n){let m=`https://music.163.com/api/song/enhance/player/url?id=${s.id}&ids=[${s.id}]&br=3200000`,{body:p}=await w(m),{data:i}=JSON.parse(p),{url:c,size:d,type:$}=i[0];Object.assign(s,{url:c,size:d,extension:$})}return r||(console.error(J(`\u6CA1\u641C\u7D22\u5230 ${o} \u7684\u76F8\u5173\u7ED3\u679C`)),process.exit(1)),n},b=L;import E from"prompts";var P=({name:o,artists:e,id:t},r)=>({title:`${r+1}. ${o} -[ ${e[0].name} ]`,value:{name:o,id:t}}),S=P;var Q=async o=>await E([{type:"select",name:"song",message:"\u5171\u6709 "+o.length+" \u4E2A\u7ED3\u679C, \u6309\u4E0B\u7A7A\u683C\u6216\u56DE\u8F66\u4E0B\u8F7D",choices:o.map((e,t)=>S(e,t))}]),x=Q;var W=async()=>{let o=await b(h),{song:e}=await x(o);e&&await y(e)},mo=W;export{mo as default};
